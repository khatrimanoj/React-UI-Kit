{"ast":null,"code":"var _jsxFileName = \"/home/mindbox/Documents/manoj/nexus/src/components/Carousel/Carousel.js\";\nimport React from 'react';\nimport PropTypes from 'prop-types';\nconst styles = {\n  wrapper: {\n    width: th,\n    height: '100%',\n    position: 'relative'\n  },\n  frame: {\n    width: '100%',\n    height: '100%',\n    position: 'absolute'\n  }\n};\n\nclass Carousel extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      frames: [].concat(props.frames || props.children || []),\n      current: 0\n    };\n    this.mounted = false;\n    this.debounceTimeoutId = null;\n    this.onTouchStart = this.onTouchStart.bind(this);\n    this.onTouchMove = this.onTouchMove.bind(this);\n    this.onTouchEnd = this.onTouchEnd.bind(this);\n    this.onResize = this.onResize.bind(this);\n    this.autoSlide = this.autoSlide.bind(this);\n    this.prev = this.prev.bind(this);\n    this.next = this.next.bind(this);\n\n    if (props.loop === false && props.auto) {\n      console.warn('[re-carousel] Auto-slide only works in loop mode.');\n    }\n  }\n\n  componentDidMount() {\n    this.mounted = true;\n    this.prepareAutoSlide();\n    this.hideFrames();\n    this.refs.wrapper.addEventListener('touchmove', this.onTouchMove, {\n      capture: true\n    });\n    this.refs.wrapper.addEventListener('touchend', this.onTouchEnd, {\n      capture: true\n    });\n    window.addEventListener('resize', this.onResize);\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n    this.clearAutoTimeout();\n    this.refs.wrapper.removeEventListener('touchmove', this.onTouchMove, {\n      capture: true\n    });\n    this.refs.wrapper.removeEventListener('touchend', this.onTouchEnd, {\n      capture: true\n    });\n    window.removeEventListener('resize', this.onResize);\n  }\n\n  componentDidUpdate(_, prevState) {\n    if (this.state.frames.length && this.state.frames.length !== prevState.frames.length) {\n      // reset to default state\n      this.hideFrames();\n      this.prepareAutoSlide();\n    }\n  }\n\n  static getDerivedStateFromProps(nextProps, prevState) {\n    const frames = [].concat(nextProps.frames || nextProps.children || []);\n    const nextState = {\n      frames\n    };\n\n    if (frames.length && frames.length !== prevState.frames.length) {\n      nextState.current = 0;\n    }\n\n    return nextState;\n  }\n\n  hideFrames() {\n    for (let i = 1; i < this.state.frames.length; i++) {\n      this.refs['f' + i].style.opacity = 0;\n    }\n  }\n\n  onResize() {\n    clearTimeout(this.debounceTimeoutId);\n    this.debounceTimeoutId = setTimeout(() => {\n      this.updateFrameSize(() => {\n        this.prepareSiblingFrames();\n      });\n    }, 25);\n  }\n\n  onTouchStart(e) {\n    if (this.state.total < 2) return; // e.preventDefault()\n\n    this.clearAutoTimeout();\n    this.updateFrameSize();\n    this.prepareSiblingFrames();\n    const {\n      pageX,\n      pageY\n    } = e.touches && e.touches[0] || e;\n    this.setState({\n      startX: pageX,\n      startY: pageY,\n      deltaX: 0,\n      deltaY: 0\n    });\n    this.refs.wrapper.addEventListener('mousemove', this.onTouchMove, {\n      capture: true\n    });\n    this.refs.wrapper.addEventListener('mouseup', this.onTouchEnd, {\n      capture: true\n    });\n    this.refs.wrapper.addEventListener('mouseleave', this.onTouchEnd, {\n      capture: true\n    });\n  }\n\n  onTouchMove(e) {\n    if (e.touches && e.touches.length > 1) return;\n    this.clearAutoTimeout();\n    const {\n      pageX,\n      pageY\n    } = e.touches && e.touches[0] || e;\n    let deltaX = pageX - this.state.startX;\n    let deltaY = pageY - this.state.startY;\n    this.setState({\n      deltaX: deltaX,\n      deltaY: deltaY\n    });\n\n    if (this.props.axis === 'x' && Math.abs(deltaX) > Math.abs(deltaY)) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n\n    if (this.props.axis === 'y' && Math.abs(deltaY) > Math.abs(deltaX)) {\n      e.preventDefault();\n      e.stopPropagation();\n    } // when reach frames edge in non-loop mode, reduce drag effect.\n\n\n    if (!this.props.loop) {\n      if (this.state.current === this.state.frames.length - 1) {\n        deltaX < 0 && (deltaX /= 3);\n        deltaY < 0 && (deltaY /= 3);\n      }\n\n      if (this.state.current === 0) {\n        deltaX > 0 && (deltaX /= 3);\n        deltaY > 0 && (deltaY /= 3);\n      }\n    }\n\n    this.moveFramesBy(deltaX, deltaY);\n  }\n\n  onTouchEnd() {\n    const direction = this.decideEndPosition();\n    direction && this.transitFramesTowards(direction); // cleanup\n\n    this.refs.wrapper.removeEventListener('mousemove', this.onTouchMove, {\n      capture: true\n    });\n    this.refs.wrapper.removeEventListener('mouseup', this.onTouchEnd, {\n      capture: true\n    });\n    this.refs.wrapper.removeEventListener('mouseleave', this.onTouchEnd, {\n      capture: true\n    });\n    setTimeout(() => this.prepareAutoSlide(), this.props.duration);\n  }\n\n  decideEndPosition() {\n    const {\n      deltaX = 0,\n      deltaY = 0,\n      current,\n      frames\n    } = this.state;\n    const {\n      axis,\n      loop,\n      minMove\n    } = this.props;\n\n    switch (axis) {\n      case 'x':\n        if (loop === false) {\n          if (current === 0 && deltaX > 0) return 'origin';\n          if (current === frames.length - 1 && deltaX < 0) return 'origin';\n        }\n\n        if (Math.abs(deltaX) < minMove) return 'origin';\n        return deltaX > 0 ? 'right' : 'left';\n\n      case 'y':\n        if (loop === false) {\n          if (current === 0 && deltaY > 0) return 'origin';\n          if (current === frames.length - 1 && deltaY < 0) return 'origin';\n        }\n\n        if (Math.abs(deltaY) < minMove) return 'origin';\n        return deltaY > 0 ? 'down' : 'up';\n\n      default:\n    }\n  }\n\n  moveFramesBy(deltaX, deltaY) {\n    const {\n      prev,\n      current,\n      next\n    } = this.state.movingFrames;\n    const {\n      frameWidth,\n      frameHeight\n    } = this.state;\n\n    switch (this.props.axis) {\n      case 'x':\n        translateXY(current, deltaX, 0);\n\n        if (deltaX < 0) {\n          translateXY(next, deltaX + frameWidth, 0);\n        } else {\n          translateXY(prev, deltaX - frameWidth, 0);\n        }\n\n        break;\n\n      case 'y':\n        translateXY(current, 0, deltaY);\n\n        if (deltaY < 0) {\n          translateXY(next, 0, deltaY + frameHeight);\n        } else {\n          translateXY(prev, 0, deltaY - frameHeight);\n        }\n\n        break;\n\n      default:\n    }\n  }\n\n  prepareAutoSlide() {\n    if (this.state.frames.length < 2) return;\n    this.clearAutoTimeout();\n    this.updateFrameSize(() => {\n      this.prepareSiblingFrames();\n    }); // auto slide only avalible in loop mode\n\n    if (this.mounted && this.props.loop && this.props.auto) {\n      const slideTimeoutID = setTimeout(this.autoSlide, this.props.interval);\n      this.setState({\n        slider: slideTimeoutID\n      });\n    }\n  } // auto slide to 'next' or 'prev'\n\n\n  autoSlide(rel) {\n    this.clearAutoTimeout();\n\n    switch (rel) {\n      case 'prev':\n        this.transitFramesTowards(this.props.axis === 'x' ? 'right' : 'down');\n        break;\n\n      case 'next':\n      default:\n        this.transitFramesTowards(this.props.axis === 'x' ? 'left' : 'up');\n    } // prepare next move after animation\n\n\n    setTimeout(() => this.prepareAutoSlide(), this.props.duration);\n  }\n\n  next() {\n    const {\n      current,\n      frames\n    } = this.state;\n    if (!this.props.loop && current === frames.length - 1) return false;\n    this.autoSlide('next');\n  }\n\n  prev() {\n    if (!this.props.loop && this.state.current === 0) return false;\n    const {\n      prev,\n      next\n    } = this.state.movingFrames;\n\n    if (prev === next) {\n      // Reprepare start position of prev frame\n      // (it was positioned as \"next\" frame)\n      if (this.props.axis === 'x') {\n        translateXY(prev, -this.state.frameWidth, 0, 0);\n      } else {\n        translateXY(prev, 0, -this.state.frameHeight, 0);\n      }\n\n      prev.getClientRects(); // trigger layout\n    }\n\n    this.autoSlide('prev');\n  }\n\n  clearAutoTimeout() {\n    clearTimeout(this.state.slider);\n  }\n\n  updateFrameSize(cb) {\n    const {\n      width,\n      height\n    } = window.getComputedStyle(this.refs.wrapper);\n    this.setState({\n      frameWidth: parseFloat(width.split('px')[0]),\n      frameHeight: parseFloat(height.split('px')[0])\n    }, cb);\n  }\n\n  getSiblingFrames() {\n    return {\n      current: this.refs['f' + this.getFrameId()],\n      prev: this.refs['f' + this.getFrameId('prev')],\n      next: this.refs['f' + this.getFrameId('next')]\n    };\n  }\n\n  prepareSiblingFrames() {\n    const siblings = this.getSiblingFrames();\n\n    if (!this.props.loop) {\n      this.state.current === 0 && (siblings.prev = undefined);\n      this.state.current === this.state.frames.length - 1 && (siblings.next = undefined);\n    }\n\n    this.setState({\n      movingFrames: siblings\n    }); // prepare frames position\n\n    translateXY(siblings.current, 0, 0);\n\n    if (this.props.axis === 'x') {\n      translateXY(siblings.prev, -this.state.frameWidth, 0);\n      translateXY(siblings.next, this.state.frameWidth, 0);\n    } else {\n      translateXY(siblings.prev, 0, -this.state.frameHeight);\n      translateXY(siblings.next, 0, this.state.frameHeight);\n    }\n\n    return siblings;\n  }\n\n  getFrameId(pos) {\n    const {\n      frames,\n      current\n    } = this.state;\n    const total = frames.length;\n\n    switch (pos) {\n      case 'prev':\n        return (current - 1 + total) % total;\n\n      case 'next':\n        return (current + 1) % total;\n\n      default:\n        return current;\n    }\n  }\n\n  transitFramesTowards(direction) {\n    const {\n      prev,\n      current,\n      next\n    } = this.state.movingFrames;\n    const {\n      duration,\n      axis,\n      onTransitionEnd\n    } = this.props;\n    let newCurrentId = this.state.current;\n\n    switch (direction) {\n      case 'up':\n        translateXY(current, 0, -this.state.frameHeight, duration);\n        translateXY(next, 0, 0, duration);\n        newCurrentId = this.getFrameId('next');\n        break;\n\n      case 'down':\n        translateXY(current, 0, this.state.frameHeight, duration);\n        translateXY(prev, 0, 0, duration);\n        newCurrentId = this.getFrameId('prev');\n        break;\n\n      case 'left':\n        translateXY(current, -this.state.frameWidth, 0, duration);\n        translateXY(next, 0, 0, duration);\n        newCurrentId = this.getFrameId('next');\n        break;\n\n      case 'right':\n        translateXY(current, this.state.frameWidth, 0, duration);\n        translateXY(prev, 0, 0, duration);\n        newCurrentId = this.getFrameId('prev');\n        break;\n\n      default:\n        // back to origin\n        translateXY(current, 0, 0, duration);\n\n        if (axis === 'x') {\n          translateXY(prev, -this.state.frameWidth, 0, duration);\n          translateXY(next, this.state.frameWidth, 0, duration);\n        } else if (axis === 'y') {\n          translateXY(prev, 0, -this.state.frameHeight, duration);\n          translateXY(next, 0, this.state.frameHeight, duration);\n        }\n\n    }\n\n    onTransitionEnd && setTimeout(() => onTransitionEnd(this.getSiblingFrames()), duration);\n    this.setState({\n      current: newCurrentId\n    });\n  } // debugFrames () {\n  //   console.log('>>> DEBUG-FRAMES: current', this.state.current)\n  //   const len = this.state.frames.length\n  //   for (let i = 0; i < len; ++i) {\n  //     const ref = this.refs['f' + i]\n  //     console.info(ref.innerText.trim(), ref.style.transform)\n  //   }\n  // }\n\n\n  render() {\n    const {\n      frames,\n      current\n    } = this.state;\n    const {\n      widgets,\n      axis,\n      loop,\n      auto,\n      interval\n    } = this.props;\n    const wrapperStyle = objectAssign(styles.wrapper, this.props.style);\n    return React.createElement(\"div\", {\n      style: wrapperStyle,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 378\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      ref: \"wrapper\",\n      style: objectAssign({\n        overflow: 'hidden'\n      }, wrapperStyle),\n      onTouchStart: this.onTouchStart,\n      className: this.props.className,\n      onMouseDown: this.onTouchStart,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 379\n      },\n      __self: this\n    }, frames.map((frame, i) => {\n      const frameStyle = objectAssign({\n        zIndex: 99 - i\n      }, styles.frame);\n      return React.createElement(\"div\", {\n        ref: 'f' + i,\n        key: i,\n        style: frameStyle,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 388\n        },\n        __self: this\n      }, frame);\n    }), this.props.frames && this.props.children), widgets && [].concat(widgets).map((Widget, i) => React.createElement(Widget, {\n      key: i,\n      index: current,\n      total: frames.length,\n      prevHandler: this.prev,\n      nextHandler: this.next,\n      axis: axis,\n      loop: loop,\n      auto: auto,\n      interval: interval,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 395\n      },\n      __self: this\n    })));\n  }\n\n}\n\nCarousel.propTypes = {\n  axis: PropTypes.oneOf(['x', 'y']),\n  auto: PropTypes.bool,\n  loop: PropTypes.bool,\n  interval: PropTypes.number,\n  duration: PropTypes.number,\n  widgets: PropTypes.arrayOf(PropTypes.func),\n  frames: PropTypes.arrayOf(PropTypes.element),\n  style: PropTypes.object,\n  minMove: PropTypes.number,\n  onTransitionEnd: PropTypes.func\n};\nCarousel.defaultProps = {\n  axis: 'x',\n  auto: false,\n  loop: false,\n  interval: 5000,\n  duration: 300,\n  minMove: 42\n};\n\nfunction translateXY(el, x, y, duration = 0) {\n  if (!el) return;\n  el.style.opacity = '1'; // animation\n\n  el.style.transitionDuration = duration + 'ms';\n  el.style.webkitTransitionDuration = duration + 'ms';\n  el.style.transform = `translate(${x}px, ${y}px)`;\n  el.style.webkitTransform = `translate(${x}px, ${y}px) translateZ(0)`;\n}\n\nfunction objectAssign(target) {\n  var output = Object(target);\n\n  for (var index = 1; index < arguments.length; index++) {\n    var source = arguments[index];\n\n    if (source !== undefined && source !== null) {\n      for (var nextKey in source) {\n        if (source.hasOwnProperty(nextKey)) {\n          output[nextKey] = source[nextKey];\n        }\n      }\n    }\n  }\n\n  return output;\n}\n\nexport default Carousel;","map":{"version":3,"sources":["/home/mindbox/Documents/manoj/nexus/src/components/Carousel/Carousel.js"],"names":["React","PropTypes","styles","wrapper","width","th","height","position","frame","Carousel","Component","constructor","props","state","frames","concat","children","current","mounted","debounceTimeoutId","onTouchStart","bind","onTouchMove","onTouchEnd","onResize","autoSlide","prev","next","loop","auto","console","warn","componentDidMount","prepareAutoSlide","hideFrames","refs","addEventListener","capture","window","componentWillUnmount","clearAutoTimeout","removeEventListener","componentDidUpdate","_","prevState","length","getDerivedStateFromProps","nextProps","nextState","i","style","opacity","clearTimeout","setTimeout","updateFrameSize","prepareSiblingFrames","e","total","pageX","pageY","touches","setState","startX","startY","deltaX","deltaY","axis","Math","abs","preventDefault","stopPropagation","moveFramesBy","direction","decideEndPosition","transitFramesTowards","duration","minMove","movingFrames","frameWidth","frameHeight","translateXY","slideTimeoutID","interval","slider","rel","getClientRects","cb","getComputedStyle","parseFloat","split","getSiblingFrames","getFrameId","siblings","undefined","pos","onTransitionEnd","newCurrentId","render","widgets","wrapperStyle","objectAssign","overflow","className","map","frameStyle","zIndex","Widget","propTypes","oneOf","bool","number","arrayOf","func","element","object","defaultProps","el","x","y","transitionDuration","webkitTransitionDuration","transform","webkitTransform","target","output","Object","index","arguments","source","nextKey","hasOwnProperty"],"mappings":"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","sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\n\nconst styles = {\n  wrapper: {\n    width: th,\n    height: '100%',\n    position: 'relative'\n  },\n  frame: {\n    width: '100%',\n    height: '100%',\n    position: 'absolute'\n  }\n}\n\nclass Carousel extends React.Component {\n  constructor (props) {\n    super(props)\n\n    this.state = {\n      frames: [].concat(props.frames || props.children || []),\n      current: 0\n    }\n\n    this.mounted = false\n    this.debounceTimeoutId = null\n    this.onTouchStart = this.onTouchStart.bind(this)\n    this.onTouchMove = this.onTouchMove.bind(this)\n    this.onTouchEnd = this.onTouchEnd.bind(this)\n    this.onResize = this.onResize.bind(this)\n    this.autoSlide = this.autoSlide.bind(this)\n    this.prev = this.prev.bind(this)\n    this.next = this.next.bind(this)\n\n    if (props.loop === false && props.auto) {\n      console.warn('[re-carousel] Auto-slide only works in loop mode.')\n    }\n  }\n\n  componentDidMount () {\n    this.mounted = true\n    this.prepareAutoSlide()\n    this.hideFrames()\n\n    this.refs.wrapper.addEventListener('touchmove', this.onTouchMove, {capture: true})\n    this.refs.wrapper.addEventListener('touchend', this.onTouchEnd, {capture: true})\n    window.addEventListener('resize', this.onResize);\n  }\n\n  componentWillUnmount () {\n    this.mounted = false\n    this.clearAutoTimeout()\n\n    this.refs.wrapper.removeEventListener('touchmove', this.onTouchMove, {capture: true})\n    this.refs.wrapper.removeEventListener('touchend', this.onTouchEnd, {capture: true})\n    window.removeEventListener('resize', this.onResize);\n  }\n\n  componentDidUpdate(_, prevState) {\n    if (this.state.frames.length && this.state.frames.length !== prevState.frames.length) {\n      // reset to default state\n      this.hideFrames()\n      this.prepareAutoSlide()\n    }\n  }\n\n  static getDerivedStateFromProps(nextProps, prevState) {\n    const frames = [].concat(nextProps.frames || nextProps.children || [])\n    const nextState = { frames }\n    if (frames.length && frames.length !== prevState.frames.length) {\n      nextState.current = 0\n    }\n    return nextState\n  }\n\n  hideFrames () {\n    for (let i = 1; i < this.state.frames.length; i++) {\n      this.refs['f' + i].style.opacity = 0\n    }\n  }\n\n  onResize() {\n    clearTimeout(this.debounceTimeoutId);\n    this.debounceTimeoutId = setTimeout(() => {\n      this.updateFrameSize(() => {\n        this.prepareSiblingFrames();\n      });\n    }, 25);\n  }\n\n  onTouchStart (e) {\n    if (this.state.total < 2) return\n    // e.preventDefault()\n\n    this.clearAutoTimeout()\n    this.updateFrameSize()\n    this.prepareSiblingFrames()\n\n    const { pageX, pageY } = (e.touches && e.touches[0]) || e\n    this.setState({\n      startX: pageX,\n      startY: pageY,\n      deltaX: 0,\n      deltaY: 0\n    })\n\n    this.refs.wrapper.addEventListener('mousemove', this.onTouchMove, {capture: true})\n    this.refs.wrapper.addEventListener('mouseup', this.onTouchEnd, {capture: true})\n    this.refs.wrapper.addEventListener('mouseleave', this.onTouchEnd, {capture: true})\n  }\n\n  onTouchMove (e) {\n    if (e.touches && e.touches.length > 1) return\n    this.clearAutoTimeout()\n\n    const { pageX, pageY } = (e.touches && e.touches[0]) || e\n    let deltaX = pageX - this.state.startX\n    let deltaY = pageY - this.state.startY\n    this.setState({\n      deltaX: deltaX,\n      deltaY: deltaY\n    })\n\n    if (this.props.axis === 'x' && Math.abs(deltaX) > Math.abs(deltaY)) {\n      e.preventDefault()\n      e.stopPropagation()\n    }\n    if (this.props.axis === 'y' && Math.abs(deltaY) > Math.abs(deltaX)) {\n      e.preventDefault()\n      e.stopPropagation()\n    }\n\n    // when reach frames edge in non-loop mode, reduce drag effect.\n    if (!this.props.loop) {\n      if (this.state.current === this.state.frames.length - 1) {\n        deltaX < 0 && (deltaX /= 3)\n        deltaY < 0 && (deltaY /= 3)\n      }\n      if (this.state.current === 0) {\n        deltaX > 0 && (deltaX /= 3)\n        deltaY > 0 && (deltaY /= 3)\n      }\n    }\n\n    this.moveFramesBy(deltaX, deltaY)\n  }\n\n  onTouchEnd () {\n    const direction = this.decideEndPosition()\n    direction && this.transitFramesTowards(direction)\n\n    // cleanup\n    this.refs.wrapper.removeEventListener('mousemove', this.onTouchMove, {capture: true})\n    this.refs.wrapper.removeEventListener('mouseup', this.onTouchEnd, {capture: true})\n    this.refs.wrapper.removeEventListener('mouseleave', this.onTouchEnd, {capture: true})\n\n    setTimeout(() => this.prepareAutoSlide(), this.props.duration)\n  }\n\n  decideEndPosition () {\n    const { deltaX = 0, deltaY = 0, current, frames } = this.state\n    const { axis, loop, minMove } = this.props\n\n    switch (axis) {\n      case 'x':\n        if (loop === false) {\n          if (current === 0 && deltaX > 0) return 'origin'\n          if (current === frames.length - 1 && deltaX < 0) return 'origin'\n        }\n        if (Math.abs(deltaX) < minMove) return 'origin'\n        return deltaX > 0 ? 'right' : 'left'\n      case 'y':\n        if (loop === false) {\n          if (current === 0 && deltaY > 0) return 'origin'\n          if (current === frames.length - 1 && deltaY < 0) return 'origin'\n        }\n        if (Math.abs(deltaY) < minMove) return 'origin'\n        return deltaY > 0 ? 'down' : 'up'\n      default:\n    }\n  }\n\n  moveFramesBy (deltaX, deltaY) {\n    const { prev, current, next } = this.state.movingFrames\n    const { frameWidth, frameHeight } = this.state\n\n    switch (this.props.axis) {\n      case 'x':\n        translateXY(current, deltaX, 0)\n        if (deltaX < 0) {\n          translateXY(next, deltaX + frameWidth, 0)\n        } else {\n          translateXY(prev, deltaX - frameWidth, 0)\n        }\n        break\n      case 'y':\n        translateXY(current, 0, deltaY)\n        if (deltaY < 0) {\n          translateXY(next, 0, deltaY + frameHeight)\n        } else {\n          translateXY(prev, 0, deltaY - frameHeight)\n        }\n        break\n      default:\n    }\n  }\n\n  prepareAutoSlide () {\n    if (this.state.frames.length < 2) return\n\n    this.clearAutoTimeout()\n    this.updateFrameSize(() => {\n      this.prepareSiblingFrames()\n    })\n\n    // auto slide only avalible in loop mode\n    if (this.mounted && this.props.loop && this.props.auto) {\n      const slideTimeoutID = setTimeout(this.autoSlide, this.props.interval)\n      this.setState({ slider: slideTimeoutID })\n    }\n  }\n\n  // auto slide to 'next' or 'prev'\n  autoSlide (rel) {\n    this.clearAutoTimeout()\n\n    switch (rel) {\n      case 'prev':\n        this.transitFramesTowards(this.props.axis === 'x' ? 'right' : 'down')\n        break\n      case 'next':\n      default:\n        this.transitFramesTowards(this.props.axis === 'x' ? 'left' : 'up')\n    }\n\n    // prepare next move after animation\n    setTimeout(() => this.prepareAutoSlide(), this.props.duration)\n  }\n\n  next () {\n    const { current, frames } = this.state\n    if (!this.props.loop && current === frames.length - 1) return false\n    this.autoSlide('next')\n  }\n\n  prev () {\n    if (!this.props.loop && this.state.current === 0) return false\n    const { prev, next } = this.state.movingFrames\n\n    if (prev === next) {\n      // Reprepare start position of prev frame\n      // (it was positioned as \"next\" frame)\n      if (this.props.axis === 'x') {\n        translateXY(prev, -this.state.frameWidth, 0, 0)\n      } else {\n        translateXY(prev, 0, -this.state.frameHeight, 0)\n      }\n      prev.getClientRects() // trigger layout\n    }\n\n    this.autoSlide('prev')\n  }\n\n  clearAutoTimeout () {\n    clearTimeout(this.state.slider)\n  }\n\n  updateFrameSize (cb) {\n    const { width, height } = window.getComputedStyle(this.refs.wrapper)\n    this.setState({\n      frameWidth: parseFloat(width.split('px')[0]),\n      frameHeight: parseFloat(height.split('px')[0])\n    }, cb)\n  }\n\n  getSiblingFrames () {\n    return {\n      current: this.refs['f' + this.getFrameId()],\n      prev: this.refs['f' + this.getFrameId('prev')],\n      next: this.refs['f' + this.getFrameId('next')]\n    }\n  }\n\n  prepareSiblingFrames () {\n    const siblings = this.getSiblingFrames()\n\n    if (!this.props.loop) {\n      this.state.current === 0 && (siblings.prev = undefined)\n      this.state.current === this.state.frames.length - 1 && (siblings.next = undefined)\n    }\n\n    this.setState({ movingFrames: siblings })\n\n    // prepare frames position\n    translateXY(siblings.current, 0, 0)\n    if (this.props.axis === 'x') {\n      translateXY(siblings.prev, -this.state.frameWidth, 0)\n      translateXY(siblings.next, this.state.frameWidth, 0)\n    } else {\n      translateXY(siblings.prev, 0, -this.state.frameHeight)\n      translateXY(siblings.next, 0, this.state.frameHeight)\n    }\n\n    return siblings\n  }\n\n  getFrameId (pos) {\n    const { frames, current } = this.state\n    const total = frames.length\n    switch (pos) {\n      case 'prev':\n        return (current - 1 + total) % total\n      case 'next':\n        return (current + 1) % total\n      default:\n        return current\n    }\n  }\n\n  transitFramesTowards (direction) {\n    const { prev, current, next } = this.state.movingFrames\n    const { duration, axis, onTransitionEnd } = this.props\n\n    let newCurrentId = this.state.current\n    switch (direction) {\n      case 'up':\n        translateXY(current, 0, -this.state.frameHeight, duration)\n        translateXY(next, 0, 0, duration)\n        newCurrentId = this.getFrameId('next')\n        break\n      case 'down':\n        translateXY(current, 0, this.state.frameHeight, duration)\n        translateXY(prev, 0, 0, duration)\n        newCurrentId = this.getFrameId('prev')\n        break\n      case 'left':\n        translateXY(current, -this.state.frameWidth, 0, duration)\n        translateXY(next, 0, 0, duration)\n        newCurrentId = this.getFrameId('next')\n        break\n      case 'right':\n        translateXY(current, this.state.frameWidth, 0, duration)\n        translateXY(prev, 0, 0, duration)\n        newCurrentId = this.getFrameId('prev')\n        break\n      default: // back to origin\n        translateXY(current, 0, 0, duration)\n        if (axis === 'x') {\n          translateXY(prev, -this.state.frameWidth, 0, duration)\n          translateXY(next, this.state.frameWidth, 0, duration)\n        } else if (axis === 'y') {\n          translateXY(prev, 0, -this.state.frameHeight, duration)\n          translateXY(next, 0, this.state.frameHeight, duration)\n        }\n    }\n\n    onTransitionEnd && setTimeout(() => onTransitionEnd(this.getSiblingFrames()), duration)\n\n    this.setState({ current: newCurrentId })\n  }\n\n  // debugFrames () {\n  //   console.log('>>> DEBUG-FRAMES: current', this.state.current)\n  //   const len = this.state.frames.length\n  //   for (let i = 0; i < len; ++i) {\n  //     const ref = this.refs['f' + i]\n  //     console.info(ref.innerText.trim(), ref.style.transform)\n  //   }\n  // }\n\n  render () {\n    const { frames, current } = this.state\n    const { widgets, axis, loop, auto, interval } = this.props\n    const wrapperStyle = objectAssign(styles.wrapper, this.props.style)\n\n    return (\n      <div style={wrapperStyle}>\n        <div\n          ref='wrapper'\n          style={objectAssign({overflow: 'hidden'}, wrapperStyle)}\n          onTouchStart={this.onTouchStart}\n          className={this.props.className}\n          onMouseDown={this.onTouchStart} >\n          {\n            frames.map((frame, i) => {\n              const frameStyle = objectAssign({zIndex: 99 - i}, styles.frame)\n              return <div ref={'f' + i} key={i} style={frameStyle}>{frame}</div>\n            })\n          }\n          { this.props.frames && this.props.children }\n        </div>\n        {\n          widgets && [].concat(widgets).map((Widget, i) => (\n            <Widget\n              key={i}\n              index={current}\n              total={frames.length}\n              prevHandler={this.prev}\n              nextHandler={this.next}\n              axis={axis} loop={loop} auto={auto} interval={interval} />\n          ))\n        }\n      </div>\n    )\n  }\n}\n\nCarousel.propTypes = {\n  axis: PropTypes.oneOf(['x', 'y']),\n  auto: PropTypes.bool,\n  loop: PropTypes.bool,\n  interval: PropTypes.number,\n  duration: PropTypes.number,\n  widgets: PropTypes.arrayOf(PropTypes.func),\n  frames: PropTypes.arrayOf(PropTypes.element),\n  style: PropTypes.object,\n  minMove: PropTypes.number,\n  onTransitionEnd: PropTypes.func\n}\n\nCarousel.defaultProps = {\n  axis: 'x',\n  auto: false,\n  loop: false,\n  interval: 5000,\n  duration: 300,\n  minMove: 42\n}\n\nfunction translateXY (el, x, y, duration = 0) {\n  if (!el) return\n\n  el.style.opacity = '1'\n\n  // animation\n  el.style.transitionDuration = duration + 'ms'\n  el.style.webkitTransitionDuration = duration + 'ms'\n\n  el.style.transform = `translate(${x}px, ${y}px)`\n  el.style.webkitTransform = `translate(${x}px, ${y}px) translateZ(0)`\n}\n\nfunction objectAssign (target) {\n  var output = Object(target)\n  for (var index = 1; index < arguments.length; index++) {\n    var source = arguments[index]\n    if (source !== undefined && source !== null) {\n      for (var nextKey in source) {\n        if (source.hasOwnProperty(nextKey)) {\n          output[nextKey] = source[nextKey]\n        }\n      }\n    }\n  }\n  return output\n}\n\nexport default Carousel"]},"metadata":{},"sourceType":"module"}