{"ast":null,"code":"import _classCallCheck from\"/home/mindbox/Documents/manoj/nexus/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/mindbox/Documents/manoj/nexus/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/mindbox/Documents/manoj/nexus/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/mindbox/Documents/manoj/nexus/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/home/mindbox/Documents/manoj/nexus/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/mindbox/Documents/manoj/nexus/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';var styles={wrapper:{width:'100%',height:'100%',position:'relative'},frame:{width:'100%',height:'100%',position:'absolute'}};var Carousel=/*#__PURE__*/function(_React$Component){_inherits(Carousel,_React$Component);function Carousel(props){var _this;_classCallCheck(this,Carousel);_this=_possibleConstructorReturn(this,_getPrototypeOf(Carousel).call(this,props));_this.state={frames:[].concat(props.frames||props.children||[]),current:0};_this.mounted=false;_this.debounceTimeoutId=null;_this.onTouchStart=_this.onTouchStart.bind(_assertThisInitialized(_this));_this.onTouchMove=_this.onTouchMove.bind(_assertThisInitialized(_this));_this.onTouchEnd=_this.onTouchEnd.bind(_assertThisInitialized(_this));_this.onResize=_this.onResize.bind(_assertThisInitialized(_this));_this.autoSlide=_this.autoSlide.bind(_assertThisInitialized(_this));_this.prev=_this.prev.bind(_assertThisInitialized(_this));_this.next=_this.next.bind(_assertThisInitialized(_this));if(props.loop===false&&props.auto){console.warn('[re-carousel] Auto-slide only works in loop mode.');}return _this;}_createClass(Carousel,[{key:\"componentDidMount\",value:function componentDidMount(){this.mounted=true;this.prepareAutoSlide();this.hideFrames();this.refs.wrapper.addEventListener('touchmove',this.onTouchMove,{capture:true});this.refs.wrapper.addEventListener('touchend',this.onTouchEnd,{capture:true});window.addEventListener('resize',this.onResize);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.mounted=false;this.clearAutoTimeout();this.refs.wrapper.removeEventListener('touchmove',this.onTouchMove,{capture:true});this.refs.wrapper.removeEventListener('touchend',this.onTouchEnd,{capture:true});window.removeEventListener('resize',this.onResize);}},{key:\"componentDidUpdate\",value:function componentDidUpdate(_,prevState){if(this.state.frames.length&&this.state.frames.length!==prevState.frames.length){// reset to default state\nthis.hideFrames();this.prepareAutoSlide();}}},{key:\"hideFrames\",value:function hideFrames(){for(var i=1;i<this.state.frames.length;i++){this.refs['f'+i].style.opacity=0;}}},{key:\"onResize\",value:function onResize(){var _this2=this;clearTimeout(this.debounceTimeoutId);this.debounceTimeoutId=setTimeout(function(){_this2.updateFrameSize(function(){_this2.prepareSiblingFrames();});},25);}},{key:\"onTouchStart\",value:function onTouchStart(e){if(this.state.total<2)return;// e.preventDefault()\nthis.clearAutoTimeout();this.updateFrameSize();this.prepareSiblingFrames();var _ref=e.touches&&e.touches[0]||e,pageX=_ref.pageX,pageY=_ref.pageY;this.setState({startX:pageX,startY:pageY,deltaX:0,deltaY:0});this.refs.wrapper.addEventListener('mousemove',this.onTouchMove,{capture:true});this.refs.wrapper.addEventListener('mouseup',this.onTouchEnd,{capture:true});this.refs.wrapper.addEventListener('mouseleave',this.onTouchEnd,{capture:true});}},{key:\"onTouchMove\",value:function onTouchMove(e){if(e.touches&&e.touches.length>1)return;this.clearAutoTimeout();var _ref2=e.touches&&e.touches[0]||e,pageX=_ref2.pageX,pageY=_ref2.pageY;var deltaX=pageX-this.state.startX;var deltaY=pageY-this.state.startY;this.setState({deltaX:deltaX,deltaY:deltaY});if(this.props.axis==='x'&&Math.abs(deltaX)>Math.abs(deltaY)){e.preventDefault();e.stopPropagation();}if(this.props.axis==='y'&&Math.abs(deltaY)>Math.abs(deltaX)){e.preventDefault();e.stopPropagation();}// when reach frames edge in non-loop mode, reduce drag effect.\nif(!this.props.loop){if(this.state.current===this.state.frames.length-1){deltaX<0&&(deltaX/=3);deltaY<0&&(deltaY/=3);}if(this.state.current===0){deltaX>0&&(deltaX/=3);deltaY>0&&(deltaY/=3);}}this.moveFramesBy(deltaX,deltaY);}},{key:\"onTouchEnd\",value:function onTouchEnd(){var _this3=this;var direction=this.decideEndPosition();direction&&this.transitFramesTowards(direction);// cleanup\nthis.refs.wrapper.removeEventListener('mousemove',this.onTouchMove,{capture:true});this.refs.wrapper.removeEventListener('mouseup',this.onTouchEnd,{capture:true});this.refs.wrapper.removeEventListener('mouseleave',this.onTouchEnd,{capture:true});setTimeout(function(){return _this3.prepareAutoSlide();},this.props.duration);}},{key:\"decideEndPosition\",value:function decideEndPosition(){var _this$state=this.state,_this$state$deltaX=_this$state.deltaX,deltaX=_this$state$deltaX===void 0?0:_this$state$deltaX,_this$state$deltaY=_this$state.deltaY,deltaY=_this$state$deltaY===void 0?0:_this$state$deltaY,current=_this$state.current,frames=_this$state.frames;var _this$props=this.props,axis=_this$props.axis,loop=_this$props.loop,minMove=_this$props.minMove;switch(axis){case'x':if(loop===false){if(current===0&&deltaX>0)return'origin';if(current===frames.length-1&&deltaX<0)return'origin';}if(Math.abs(deltaX)<minMove)return'origin';return deltaX>0?'right':'left';case'y':if(loop===false){if(current===0&&deltaY>0)return'origin';if(current===frames.length-1&&deltaY<0)return'origin';}if(Math.abs(deltaY)<minMove)return'origin';return deltaY>0?'down':'up';default:}}},{key:\"moveFramesBy\",value:function moveFramesBy(deltaX,deltaY){var _this$state$movingFra=this.state.movingFrames,prev=_this$state$movingFra.prev,current=_this$state$movingFra.current,next=_this$state$movingFra.next;var _this$state2=this.state,frameWidth=_this$state2.frameWidth,frameHeight=_this$state2.frameHeight;switch(this.props.axis){case'x':translateXY(current,deltaX,0);if(deltaX<0){translateXY(next,deltaX+frameWidth,0);}else{translateXY(prev,deltaX-frameWidth,0);}break;case'y':translateXY(current,0,deltaY);if(deltaY<0){translateXY(next,0,deltaY+frameHeight);}else{translateXY(prev,0,deltaY-frameHeight);}break;default:}}},{key:\"prepareAutoSlide\",value:function prepareAutoSlide(){var _this4=this;if(this.state.frames.length<2)return;this.clearAutoTimeout();this.updateFrameSize(function(){_this4.prepareSiblingFrames();});// auto slide only avalible in loop mode\nif(this.mounted&&this.props.loop&&this.props.auto){var slideTimeoutID=setTimeout(this.autoSlide,this.props.interval);this.setState({slider:slideTimeoutID});}}// auto slide to 'next' or 'prev'\n},{key:\"autoSlide\",value:function autoSlide(rel){var _this5=this;this.clearAutoTimeout();switch(rel){case'prev':this.transitFramesTowards(this.props.axis==='x'?'right':'down');break;case'next':default:this.transitFramesTowards(this.props.axis==='x'?'left':'up');}// prepare next move after animation\nsetTimeout(function(){return _this5.prepareAutoSlide();},this.props.duration);}},{key:\"next\",value:function next(){var _this$state3=this.state,current=_this$state3.current,frames=_this$state3.frames;if(!this.props.loop&&current===frames.length-1)return false;this.autoSlide('next');}},{key:\"prev\",value:function prev(){if(!this.props.loop&&this.state.current===0)return false;var _this$state$movingFra2=this.state.movingFrames,prev=_this$state$movingFra2.prev,next=_this$state$movingFra2.next;if(prev===next){// Reprepare start position of prev frame\n// (it was positioned as \"next\" frame)\nif(this.props.axis==='x'){translateXY(prev,-this.state.frameWidth,0,0);}else{translateXY(prev,0,-this.state.frameHeight,0);}prev.getClientRects();// trigger layout\n}this.autoSlide('prev');}},{key:\"clearAutoTimeout\",value:function clearAutoTimeout(){clearTimeout(this.state.slider);}},{key:\"updateFrameSize\",value:function updateFrameSize(cb){var _window$getComputedSt=window.getComputedStyle(this.refs.wrapper),width=_window$getComputedSt.width,height=_window$getComputedSt.height;this.setState({frameWidth:parseFloat(width.split('px')[0]),frameHeight:parseFloat(height.split('px')[0])},cb);}},{key:\"getSiblingFrames\",value:function getSiblingFrames(){return{current:this.refs['f'+this.getFrameId()],prev:this.refs['f'+this.getFrameId('prev')],next:this.refs['f'+this.getFrameId('next')]};}},{key:\"prepareSiblingFrames\",value:function prepareSiblingFrames(){var siblings=this.getSiblingFrames();if(!this.props.loop){this.state.current===0&&(siblings.prev=undefined);this.state.current===this.state.frames.length-1&&(siblings.next=undefined);}this.setState({movingFrames:siblings});// prepare frames position\ntranslateXY(siblings.current,0,0);if(this.props.axis==='x'){translateXY(siblings.prev,-this.state.frameWidth,0);translateXY(siblings.next,this.state.frameWidth,0);}else{translateXY(siblings.prev,0,-this.state.frameHeight);translateXY(siblings.next,0,this.state.frameHeight);}return siblings;}},{key:\"getFrameId\",value:function getFrameId(pos){var _this$state4=this.state,frames=_this$state4.frames,current=_this$state4.current;var total=frames.length;switch(pos){case'prev':return(current-1+total)%total;case'next':return(current+1)%total;default:return current;}}},{key:\"transitFramesTowards\",value:function transitFramesTowards(direction){var _this6=this;var _this$state$movingFra3=this.state.movingFrames,prev=_this$state$movingFra3.prev,current=_this$state$movingFra3.current,next=_this$state$movingFra3.next;var _this$props2=this.props,duration=_this$props2.duration,axis=_this$props2.axis,onTransitionEnd=_this$props2.onTransitionEnd;var newCurrentId=this.state.current;switch(direction){case'up':translateXY(current,0,-this.state.frameHeight,duration);translateXY(next,0,0,duration);newCurrentId=this.getFrameId('next');break;case'down':translateXY(current,0,this.state.frameHeight,duration);translateXY(prev,0,0,duration);newCurrentId=this.getFrameId('prev');break;case'left':translateXY(current,-this.state.frameWidth,0,duration);translateXY(next,0,0,duration);newCurrentId=this.getFrameId('next');break;case'right':translateXY(current,this.state.frameWidth,0,duration);translateXY(prev,0,0,duration);newCurrentId=this.getFrameId('prev');break;default:// back to origin\ntranslateXY(current,0,0,duration);if(axis==='x'){translateXY(prev,-this.state.frameWidth,0,duration);translateXY(next,this.state.frameWidth,0,duration);}else if(axis==='y'){translateXY(prev,0,-this.state.frameHeight,duration);translateXY(next,0,this.state.frameHeight,duration);}}onTransitionEnd&&setTimeout(function(){return onTransitionEnd(_this6.getSiblingFrames());},duration);this.setState({current:newCurrentId});}// debugFrames () {\n//   console.log('>>> DEBUG-FRAMES: current', this.state.current)\n//   const len = this.state.frames.length\n//   for (let i = 0; i < len; ++i) {\n//     const ref = this.refs['f' + i]\n//     console.info(ref.innerText.trim(), ref.style.transform)\n//   }\n// }\n},{key:\"render\",value:function render(){var _this7=this;var _this$state5=this.state,frames=_this$state5.frames,current=_this$state5.current;var _this$props3=this.props,widgets=_this$props3.widgets,axis=_this$props3.axis,loop=_this$props3.loop,auto=_this$props3.auto,interval=_this$props3.interval;var wrapperStyle=objectAssign(styles.wrapper,this.props.style);return React.createElement(\"div\",{style:wrapperStyle},React.createElement(\"div\",{ref:\"wrapper\",style:objectAssign({overflow:'hidden'},wrapperStyle),onTouchStart:this.onTouchStart,className:this.props.className,onMouseDown:this.onTouchStart},frames.map(function(frame,i){var frameStyle=objectAssign({zIndex:99-i},styles.frame);return React.createElement(\"div\",{ref:'f'+i,key:i,style:frameStyle},frame);}),this.props.frames&&this.props.children),widgets&&[].concat(widgets).map(function(Widget,i){return React.createElement(Widget,{key:i,index:current,total:frames.length,prevHandler:_this7.prev,nextHandler:_this7.next,axis:axis,loop:loop,auto:auto,interval:interval});}));}}],[{key:\"getDerivedStateFromProps\",value:function getDerivedStateFromProps(nextProps,prevState){var frames=[].concat(nextProps.frames||nextProps.children||[]);var nextState={frames:frames};if(frames.length&&frames.length!==prevState.frames.length){nextState.current=0;}return nextState;}}]);return Carousel;}(React.Component);Carousel.defaultProps={axis:'x',auto:false,loop:false,interval:5000,duration:300,minMove:42};function translateXY(el,x,y){var duration=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;if(!el)return;el.style.opacity='1';// animation\nel.style.transitionDuration=duration+'ms';el.style.webkitTransitionDuration=duration+'ms';el.style.transform=\"translate(\".concat(x,\"px, \").concat(y,\"px)\");el.style.webkitTransform=\"translate(\".concat(x,\"px, \").concat(y,\"px) translateZ(0)\");}function objectAssign(target){var output=Object(target);for(var index=1;index<arguments.length;index++){var source=arguments[index];if(source!==undefined&&source!==null){for(var nextKey in source){if(source.hasOwnProperty(nextKey)){output[nextKey]=source[nextKey];}}}}return output;}export default Carousel;","map":{"version":3,"sources":["/home/mindbox/Documents/manoj/nexus/src/components/Carousel/Carousel.js"],"names":["React","styles","wrapper","width","height","position","frame","Carousel","props","state","frames","concat","children","current","mounted","debounceTimeoutId","onTouchStart","bind","onTouchMove","onTouchEnd","onResize","autoSlide","prev","next","loop","auto","console","warn","prepareAutoSlide","hideFrames","refs","addEventListener","capture","window","clearAutoTimeout","removeEventListener","_","prevState","length","i","style","opacity","clearTimeout","setTimeout","updateFrameSize","prepareSiblingFrames","e","total","touches","pageX","pageY","setState","startX","startY","deltaX","deltaY","axis","Math","abs","preventDefault","stopPropagation","moveFramesBy","direction","decideEndPosition","transitFramesTowards","duration","minMove","movingFrames","frameWidth","frameHeight","translateXY","slideTimeoutID","interval","slider","rel","getClientRects","cb","getComputedStyle","parseFloat","split","getFrameId","siblings","getSiblingFrames","undefined","pos","onTransitionEnd","newCurrentId","widgets","wrapperStyle","objectAssign","overflow","className","map","frameStyle","zIndex","Widget","nextProps","nextState","Component","defaultProps","el","x","y","transitionDuration","webkitTransitionDuration","transform","webkitTransform","target","output","Object","index","arguments","source","nextKey","hasOwnProperty"],"mappings":"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","sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\n\nconst styles = {\n  wrapper: {\n    width: '100%',\n    height: '100%',\n    position: 'relative'\n  },\n  frame: {\n    width: '100%',\n    height: '100%',\n    position: 'absolute'\n  }\n}\n\nclass Carousel extends React.Component {\n  constructor (props) {\n    super(props)\n\n    this.state = {\n      frames: [].concat(props.frames || props.children || []),\n      current: 0\n    }\n\n    this.mounted = false\n    this.debounceTimeoutId = null\n    this.onTouchStart = this.onTouchStart.bind(this)\n    this.onTouchMove = this.onTouchMove.bind(this)\n    this.onTouchEnd = this.onTouchEnd.bind(this)\n    this.onResize = this.onResize.bind(this)\n    this.autoSlide = this.autoSlide.bind(this)\n    this.prev = this.prev.bind(this)\n    this.next = this.next.bind(this)\n\n    if (props.loop === false && props.auto) {\n      console.warn('[re-carousel] Auto-slide only works in loop mode.')\n    }\n  }\n\n  componentDidMount () {\n    this.mounted = true\n    this.prepareAutoSlide()\n    this.hideFrames()\n\n    this.refs.wrapper.addEventListener('touchmove', this.onTouchMove, {capture: true})\n    this.refs.wrapper.addEventListener('touchend', this.onTouchEnd, {capture: true})\n    window.addEventListener('resize', this.onResize);\n  }\n\n  componentWillUnmount () {\n    this.mounted = false\n    this.clearAutoTimeout()\n\n    this.refs.wrapper.removeEventListener('touchmove', this.onTouchMove, {capture: true})\n    this.refs.wrapper.removeEventListener('touchend', this.onTouchEnd, {capture: true})\n    window.removeEventListener('resize', this.onResize);\n  }\n\n  componentDidUpdate(_, prevState) {\n    if (this.state.frames.length && this.state.frames.length !== prevState.frames.length) {\n      // reset to default state\n      this.hideFrames()\n      this.prepareAutoSlide()\n    }\n  }\n\n  static getDerivedStateFromProps(nextProps, prevState) {\n    const frames = [].concat(nextProps.frames || nextProps.children || [])\n    const nextState = { frames }\n    if (frames.length && frames.length !== prevState.frames.length) {\n      nextState.current = 0\n    }\n    return nextState\n  }\n\n  hideFrames () {\n    for (let i = 1; i < this.state.frames.length; i++) {\n      this.refs['f' + i].style.opacity = 0\n    }\n  }\n\n  onResize() {\n    clearTimeout(this.debounceTimeoutId);\n    this.debounceTimeoutId = setTimeout(() => {\n      this.updateFrameSize(() => {\n        this.prepareSiblingFrames();\n      });\n    }, 25);\n  }\n\n  onTouchStart (e) {\n    if (this.state.total < 2) return\n    // e.preventDefault()\n\n    this.clearAutoTimeout()\n    this.updateFrameSize()\n    this.prepareSiblingFrames()\n\n    const { pageX, pageY } = (e.touches && e.touches[0]) || e\n    this.setState({\n      startX: pageX,\n      startY: pageY,\n      deltaX: 0,\n      deltaY: 0\n    })\n\n    this.refs.wrapper.addEventListener('mousemove', this.onTouchMove, {capture: true})\n    this.refs.wrapper.addEventListener('mouseup', this.onTouchEnd, {capture: true})\n    this.refs.wrapper.addEventListener('mouseleave', this.onTouchEnd, {capture: true})\n  }\n\n  onTouchMove (e) {\n    if (e.touches && e.touches.length > 1) return\n    this.clearAutoTimeout()\n\n    const { pageX, pageY } = (e.touches && e.touches[0]) || e\n    let deltaX = pageX - this.state.startX\n    let deltaY = pageY - this.state.startY\n    this.setState({\n      deltaX: deltaX,\n      deltaY: deltaY\n    })\n\n    if (this.props.axis === 'x' && Math.abs(deltaX) > Math.abs(deltaY)) {\n      e.preventDefault()\n      e.stopPropagation()\n    }\n    if (this.props.axis === 'y' && Math.abs(deltaY) > Math.abs(deltaX)) {\n      e.preventDefault()\n      e.stopPropagation()\n    }\n\n    // when reach frames edge in non-loop mode, reduce drag effect.\n    if (!this.props.loop) {\n      if (this.state.current === this.state.frames.length - 1) {\n        deltaX < 0 && (deltaX /= 3)\n        deltaY < 0 && (deltaY /= 3)\n      }\n      if (this.state.current === 0) {\n        deltaX > 0 && (deltaX /= 3)\n        deltaY > 0 && (deltaY /= 3)\n      }\n    }\n\n    this.moveFramesBy(deltaX, deltaY)\n  }\n\n  onTouchEnd () {\n    const direction = this.decideEndPosition()\n    direction && this.transitFramesTowards(direction)\n\n    // cleanup\n    this.refs.wrapper.removeEventListener('mousemove', this.onTouchMove, {capture: true})\n    this.refs.wrapper.removeEventListener('mouseup', this.onTouchEnd, {capture: true})\n    this.refs.wrapper.removeEventListener('mouseleave', this.onTouchEnd, {capture: true})\n\n    setTimeout(() => this.prepareAutoSlide(), this.props.duration)\n  }\n\n  decideEndPosition () {\n    const { deltaX = 0, deltaY = 0, current, frames } = this.state\n    const { axis, loop, minMove } = this.props\n\n    switch (axis) {\n      case 'x':\n        if (loop === false) {\n          if (current === 0 && deltaX > 0) return 'origin'\n          if (current === frames.length - 1 && deltaX < 0) return 'origin'\n        }\n        if (Math.abs(deltaX) < minMove) return 'origin'\n        return deltaX > 0 ? 'right' : 'left'\n      case 'y':\n        if (loop === false) {\n          if (current === 0 && deltaY > 0) return 'origin'\n          if (current === frames.length - 1 && deltaY < 0) return 'origin'\n        }\n        if (Math.abs(deltaY) < minMove) return 'origin'\n        return deltaY > 0 ? 'down' : 'up'\n      default:\n    }\n  }\n\n  moveFramesBy (deltaX, deltaY) {\n    const { prev, current, next } = this.state.movingFrames\n    const { frameWidth, frameHeight } = this.state\n\n    switch (this.props.axis) {\n      case 'x':\n        translateXY(current, deltaX, 0)\n        if (deltaX < 0) {\n          translateXY(next, deltaX + frameWidth, 0)\n        } else {\n          translateXY(prev, deltaX - frameWidth, 0)\n        }\n        break\n      case 'y':\n        translateXY(current, 0, deltaY)\n        if (deltaY < 0) {\n          translateXY(next, 0, deltaY + frameHeight)\n        } else {\n          translateXY(prev, 0, deltaY - frameHeight)\n        }\n        break\n      default:\n    }\n  }\n\n  prepareAutoSlide () {\n    if (this.state.frames.length < 2) return\n\n    this.clearAutoTimeout()\n    this.updateFrameSize(() => {\n      this.prepareSiblingFrames()\n    })\n\n    // auto slide only avalible in loop mode\n    if (this.mounted && this.props.loop && this.props.auto) {\n      const slideTimeoutID = setTimeout(this.autoSlide, this.props.interval)\n      this.setState({ slider: slideTimeoutID })\n    }\n  }\n\n  // auto slide to 'next' or 'prev'\n  autoSlide (rel) {\n    this.clearAutoTimeout()\n\n    switch (rel) {\n      case 'prev':\n        this.transitFramesTowards(this.props.axis === 'x' ? 'right' : 'down')\n        break\n      case 'next':\n      default:\n        this.transitFramesTowards(this.props.axis === 'x' ? 'left' : 'up')\n    }\n\n    // prepare next move after animation\n    setTimeout(() => this.prepareAutoSlide(), this.props.duration)\n  }\n\n  next () {\n    const { current, frames } = this.state\n    if (!this.props.loop && current === frames.length - 1) return false\n    this.autoSlide('next')\n  }\n\n  prev () {\n    if (!this.props.loop && this.state.current === 0) return false\n    const { prev, next } = this.state.movingFrames\n\n    if (prev === next) {\n      // Reprepare start position of prev frame\n      // (it was positioned as \"next\" frame)\n      if (this.props.axis === 'x') {\n        translateXY(prev, -this.state.frameWidth, 0, 0)\n      } else {\n        translateXY(prev, 0, -this.state.frameHeight, 0)\n      }\n      prev.getClientRects() // trigger layout\n    }\n\n    this.autoSlide('prev')\n  }\n\n  clearAutoTimeout () {\n    clearTimeout(this.state.slider)\n  }\n\n  updateFrameSize (cb) {\n    const { width, height } = window.getComputedStyle(this.refs.wrapper)\n    this.setState({\n      frameWidth: parseFloat(width.split('px')[0]),\n      frameHeight: parseFloat(height.split('px')[0])\n    }, cb)\n  }\n\n  getSiblingFrames () {\n    return {\n      current: this.refs['f' + this.getFrameId()],\n      prev: this.refs['f' + this.getFrameId('prev')],\n      next: this.refs['f' + this.getFrameId('next')]\n    }\n  }\n\n  prepareSiblingFrames () {\n    const siblings = this.getSiblingFrames()\n\n    if (!this.props.loop) {\n      this.state.current === 0 && (siblings.prev = undefined)\n      this.state.current === this.state.frames.length - 1 && (siblings.next = undefined)\n    }\n\n    this.setState({ movingFrames: siblings })\n\n    // prepare frames position\n    translateXY(siblings.current, 0, 0)\n    if (this.props.axis === 'x') {\n      translateXY(siblings.prev, -this.state.frameWidth, 0)\n      translateXY(siblings.next, this.state.frameWidth, 0)\n    } else {\n      translateXY(siblings.prev, 0, -this.state.frameHeight)\n      translateXY(siblings.next, 0, this.state.frameHeight)\n    }\n\n    return siblings\n  }\n\n  getFrameId (pos) {\n    const { frames, current } = this.state\n    const total = frames.length\n    switch (pos) {\n      case 'prev':\n        return (current - 1 + total) % total\n      case 'next':\n        return (current + 1) % total\n      default:\n        return current\n    }\n  }\n\n  transitFramesTowards (direction) {\n    const { prev, current, next } = this.state.movingFrames\n    const { duration, axis, onTransitionEnd } = this.props\n\n    let newCurrentId = this.state.current\n    switch (direction) {\n      case 'up':\n        translateXY(current, 0, -this.state.frameHeight, duration)\n        translateXY(next, 0, 0, duration)\n        newCurrentId = this.getFrameId('next')\n        break\n      case 'down':\n        translateXY(current, 0, this.state.frameHeight, duration)\n        translateXY(prev, 0, 0, duration)\n        newCurrentId = this.getFrameId('prev')\n        break\n      case 'left':\n        translateXY(current, -this.state.frameWidth, 0, duration)\n        translateXY(next, 0, 0, duration)\n        newCurrentId = this.getFrameId('next')\n        break\n      case 'right':\n        translateXY(current, this.state.frameWidth, 0, duration)\n        translateXY(prev, 0, 0, duration)\n        newCurrentId = this.getFrameId('prev')\n        break\n      default: // back to origin\n        translateXY(current, 0, 0, duration)\n        if (axis === 'x') {\n          translateXY(prev, -this.state.frameWidth, 0, duration)\n          translateXY(next, this.state.frameWidth, 0, duration)\n        } else if (axis === 'y') {\n          translateXY(prev, 0, -this.state.frameHeight, duration)\n          translateXY(next, 0, this.state.frameHeight, duration)\n        }\n    }\n\n    onTransitionEnd && setTimeout(() => onTransitionEnd(this.getSiblingFrames()), duration)\n\n    this.setState({ current: newCurrentId })\n  }\n\n  // debugFrames () {\n  //   console.log('>>> DEBUG-FRAMES: current', this.state.current)\n  //   const len = this.state.frames.length\n  //   for (let i = 0; i < len; ++i) {\n  //     const ref = this.refs['f' + i]\n  //     console.info(ref.innerText.trim(), ref.style.transform)\n  //   }\n  // }\n\n  render () {\n    const { frames, current } = this.state\n    const { widgets, axis, loop, auto, interval } = this.props\n    const wrapperStyle = objectAssign(styles.wrapper, this.props.style)\n\n    return (\n      <div style={wrapperStyle}>\n        <div\n          ref='wrapper'\n          style={objectAssign({overflow: 'hidden'}, wrapperStyle)}\n          onTouchStart={this.onTouchStart}\n          className={this.props.className}\n          onMouseDown={this.onTouchStart} >\n          {\n            frames.map((frame, i) => {\n              const frameStyle = objectAssign({zIndex: 99 - i}, styles.frame)\n              return <div ref={'f' + i} key={i} style={frameStyle}>{frame}</div>\n            })\n          }\n          { this.props.frames && this.props.children }\n        </div>\n        {\n          widgets && [].concat(widgets).map((Widget, i) => (\n            <Widget\n              key={i}\n              index={current}\n              total={frames.length}\n              prevHandler={this.prev}\n              nextHandler={this.next}\n              axis={axis} loop={loop} auto={auto} interval={interval} />\n          ))\n        }\n      </div>\n    )\n  }\n}\n\nCarousel.propTypes = {\n  axis: PropTypes.oneOf(['x', 'y']),\n  auto: PropTypes.bool,\n  loop: PropTypes.bool,\n  interval: PropTypes.number,\n  duration: PropTypes.number,\n  widgets: PropTypes.arrayOf(PropTypes.func),\n  frames: PropTypes.arrayOf(PropTypes.element),\n  style: PropTypes.object,\n  minMove: PropTypes.number,\n  onTransitionEnd: PropTypes.func\n}\n\nCarousel.defaultProps = {\n  axis: 'x',\n  auto: false,\n  loop: false,\n  interval: 5000,\n  duration: 300,\n  minMove: 42\n}\n\nfunction translateXY (el, x, y, duration = 0) {\n  if (!el) return\n\n  el.style.opacity = '1'\n\n  // animation\n  el.style.transitionDuration = duration + 'ms'\n  el.style.webkitTransitionDuration = duration + 'ms'\n\n  el.style.transform = `translate(${x}px, ${y}px)`\n  el.style.webkitTransform = `translate(${x}px, ${y}px) translateZ(0)`\n}\n\nfunction objectAssign (target) {\n  var output = Object(target)\n  for (var index = 1; index < arguments.length; index++) {\n    var source = arguments[index]\n    if (source !== undefined && source !== null) {\n      for (var nextKey in source) {\n        if (source.hasOwnProperty(nextKey)) {\n          output[nextKey] = source[nextKey]\n        }\n      }\n    }\n  }\n  return output\n}\n\nexport default Carousel"]},"metadata":{},"sourceType":"module"}