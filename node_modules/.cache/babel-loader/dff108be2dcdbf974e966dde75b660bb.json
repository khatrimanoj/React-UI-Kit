{"ast":null,"code":"var _jsxFileName = \"/home/mindbox/Documents/manoj/nexus/src/components/Carousel/Carousel.js\";\nimport React from 'react';\nimport PropTypes from 'prop-types';\nconst styles = {\n  frame: {\n    width: '100%',\n    height: '100%',\n    position: 'absolute'\n  }\n};\n\nclass Carousel extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      frames: [].concat(props.frames || props.children || []),\n      current: 0,\n      width: this.props.width,\n      height: this.props.height,\n      position: this.props.pos\n    };\n    this.mounted = false;\n    this.debounceTimeoutId = null;\n    this.onTouchStart = this.onTouchStart.bind(this);\n    this.onTouchMove = this.onTouchMove.bind(this);\n    this.onTouchEnd = this.onTouchEnd.bind(this);\n    this.onResize = this.onResize.bind(this);\n    this.autoSlide = this.autoSlide.bind(this);\n    this.prev = this.prev.bind(this);\n    this.next = this.next.bind(this);\n\n    if (props.loop === false && props.auto) {\n      console.warn('[re-carousel] Auto-slide only works in loop mode.');\n    }\n  }\n\n  componentDidMount() {\n    this.mounted = true;\n    this.prepareAutoSlide();\n    this.hideFrames();\n    this.refs.wrapper.addEventListener('touchmove', this.onTouchMove, {\n      capture: true\n    });\n    this.refs.wrapper.addEventListener('touchend', this.onTouchEnd, {\n      capture: true\n    });\n    window.addEventListener('resize', this.onResize);\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n    this.clearAutoTimeout();\n    this.refs.wrapper.removeEventListener('touchmove', this.onTouchMove, {\n      capture: true\n    });\n    this.refs.wrapper.removeEventListener('touchend', this.onTouchEnd, {\n      capture: true\n    });\n    window.removeEventListener('resize', this.onResize);\n  }\n\n  componentDidUpdate(_, prevState) {\n    if (this.state.frames.length && this.state.frames.length !== prevState.frames.length) {\n      // reset to default state\n      this.hideFrames();\n      this.prepareAutoSlide();\n    }\n  }\n\n  static getDerivedStateFromProps(nextProps, prevState) {\n    const frames = [].concat(nextProps.frames || nextProps.children || []);\n    const nextState = {\n      frames\n    };\n\n    if (frames.length && frames.length !== prevState.frames.length) {\n      nextState.current = 0;\n    }\n\n    return nextState;\n  }\n\n  hideFrames() {\n    for (let i = 1; i < this.state.frames.length; i++) {\n      this.refs['f' + i].style.opacity = 0;\n    }\n  }\n\n  onResize() {\n    clearTimeout(this.debounceTimeoutId);\n    this.debounceTimeoutId = setTimeout(() => {\n      this.updateFrameSize(() => {\n        this.prepareSiblingFrames();\n      });\n    }, 25);\n  }\n\n  onTouchStart(e) {\n    if (this.state.total < 2) return; // e.preventDefault()\n\n    this.clearAutoTimeout();\n    this.updateFrameSize();\n    this.prepareSiblingFrames();\n    const {\n      pageX,\n      pageY\n    } = e.touches && e.touches[0] || e;\n    this.setState({\n      startX: pageX,\n      startY: pageY,\n      deltaX: 0,\n      deltaY: 0\n    });\n    this.refs.wrapper.addEventListener('mousemove', this.onTouchMove, {\n      capture: true\n    });\n    this.refs.wrapper.addEventListener('mouseup', this.onTouchEnd, {\n      capture: true\n    });\n    this.refs.wrapper.addEventListener('mouseleave', this.onTouchEnd, {\n      capture: true\n    });\n  }\n\n  onTouchMove(e) {\n    if (e.touches && e.touches.length > 1) return;\n    this.clearAutoTimeout();\n    const {\n      pageX,\n      pageY\n    } = e.touches && e.touches[0] || e;\n    let deltaX = pageX - this.state.startX;\n    let deltaY = pageY - this.state.startY;\n    this.setState({\n      deltaX: deltaX,\n      deltaY: deltaY\n    });\n\n    if (this.props.axis === 'x' && Math.abs(deltaX) > Math.abs(deltaY)) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n\n    if (this.props.axis === 'y' && Math.abs(deltaY) > Math.abs(deltaX)) {\n      e.preventDefault();\n      e.stopPropagation();\n    } // when reach frames edge in non-loop mode, reduce drag effect.\n\n\n    if (!this.props.loop) {\n      if (this.state.current === this.state.frames.length - 1) {\n        deltaX < 0 && (deltaX /= 3);\n        deltaY < 0 && (deltaY /= 3);\n      }\n\n      if (this.state.current === 0) {\n        deltaX > 0 && (deltaX /= 3);\n        deltaY > 0 && (deltaY /= 3);\n      }\n    }\n\n    this.moveFramesBy(deltaX, deltaY);\n  }\n\n  onTouchEnd() {\n    const direction = this.decideEndPosition();\n    direction && this.transitFramesTowards(direction); // cleanup\n\n    this.refs.wrapper.removeEventListener('mousemove', this.onTouchMove, {\n      capture: true\n    });\n    this.refs.wrapper.removeEventListener('mouseup', this.onTouchEnd, {\n      capture: true\n    });\n    this.refs.wrapper.removeEventListener('mouseleave', this.onTouchEnd, {\n      capture: true\n    });\n    setTimeout(() => this.prepareAutoSlide(), this.props.duration);\n  }\n\n  decideEndPosition() {\n    const {\n      deltaX = 0,\n      deltaY = 0,\n      current,\n      frames\n    } = this.state;\n    const {\n      axis,\n      loop,\n      minMove\n    } = this.props;\n\n    switch (axis) {\n      case 'x':\n        if (loop === false) {\n          if (current === 0 && deltaX > 0) return 'origin';\n          if (current === frames.length - 1 && deltaX < 0) return 'origin';\n        }\n\n        if (Math.abs(deltaX) < minMove) return 'origin';\n        return deltaX > 0 ? 'right' : 'left';\n\n      case 'y':\n        if (loop === false) {\n          if (current === 0 && deltaY > 0) return 'origin';\n          if (current === frames.length - 1 && deltaY < 0) return 'origin';\n        }\n\n        if (Math.abs(deltaY) < minMove) return 'origin';\n        return deltaY > 0 ? 'down' : 'up';\n\n      default:\n    }\n  }\n\n  moveFramesBy(deltaX, deltaY) {\n    const {\n      prev,\n      current,\n      next\n    } = this.state.movingFrames;\n    const {\n      frameWidth,\n      frameHeight\n    } = this.state;\n\n    switch (this.props.axis) {\n      case 'x':\n        translateXY(current, deltaX, 0);\n\n        if (deltaX < 0) {\n          translateXY(next, deltaX + frameWidth, 0);\n        } else {\n          translateXY(prev, deltaX - frameWidth, 0);\n        }\n\n        break;\n\n      case 'y':\n        translateXY(current, 0, deltaY);\n\n        if (deltaY < 0) {\n          translateXY(next, 0, deltaY + frameHeight);\n        } else {\n          translateXY(prev, 0, deltaY - frameHeight);\n        }\n\n        break;\n\n      default:\n    }\n  }\n\n  prepareAutoSlide() {\n    if (this.state.frames.length < 2) return;\n    this.clearAutoTimeout();\n    this.updateFrameSize(() => {\n      this.prepareSiblingFrames();\n    }); // auto slide only avalible in loop mode\n\n    if (this.mounted && this.props.loop && this.props.auto) {\n      const slideTimeoutID = setTimeout(this.autoSlide, this.props.interval);\n      this.setState({\n        slider: slideTimeoutID\n      });\n    }\n  } // auto slide to 'next' or 'prev'\n\n\n  autoSlide(rel) {\n    this.clearAutoTimeout();\n\n    switch (rel) {\n      case 'prev':\n        this.transitFramesTowards(this.props.axis === 'x' ? 'right' : 'down');\n        break;\n\n      case 'next':\n      default:\n        this.transitFramesTowards(this.props.axis === 'x' ? 'left' : 'up');\n    } // prepare next move after animation\n\n\n    setTimeout(() => this.prepareAutoSlide(), this.props.duration);\n  }\n\n  next() {\n    const {\n      current,\n      frames\n    } = this.state;\n    if (!this.props.loop && current === frames.length - 1) return false;\n    this.autoSlide('next');\n  }\n\n  prev() {\n    if (!this.props.loop && this.state.current === 0) return false;\n    const {\n      prev,\n      next\n    } = this.state.movingFrames;\n\n    if (prev === next) {\n      // Reprepare start position of prev frame\n      // (it was positioned as \"next\" frame)\n      if (this.props.axis === 'x') {\n        translateXY(prev, -this.state.frameWidth, 0, 0);\n      } else {\n        translateXY(prev, 0, -this.state.frameHeight, 0);\n      }\n\n      prev.getClientRects(); // trigger layout\n    }\n\n    this.autoSlide('prev');\n  }\n\n  clearAutoTimeout() {\n    clearTimeout(this.state.slider);\n  }\n\n  updateFrameSize(cb) {\n    const {\n      width,\n      height\n    } = window.getComputedStyle(this.refs.wrapper);\n    this.setState({\n      frameWidth: parseFloat(width.split('px')[0]),\n      frameHeight: parseFloat(height.split('px')[0])\n    }, cb);\n  }\n\n  getSiblingFrames() {\n    return {\n      current: this.refs['f' + this.getFrameId()],\n      prev: this.refs['f' + this.getFrameId('prev')],\n      next: this.refs['f' + this.getFrameId('next')]\n    };\n  }\n\n  prepareSiblingFrames() {\n    const siblings = this.getSiblingFrames();\n\n    if (!this.props.loop) {\n      this.state.current === 0 && (siblings.prev = undefined);\n      this.state.current === this.state.frames.length - 1 && (siblings.next = undefined);\n    }\n\n    this.setState({\n      movingFrames: siblings\n    }); // prepare frames position\n\n    translateXY(siblings.current, 0, 0);\n\n    if (this.props.axis === 'x') {\n      translateXY(siblings.prev, -this.state.frameWidth, 0);\n      translateXY(siblings.next, this.state.frameWidth, 0);\n    } else {\n      translateXY(siblings.prev, 0, -this.state.frameHeight);\n      translateXY(siblings.next, 0, this.state.frameHeight);\n    }\n\n    return siblings;\n  }\n\n  getFrameId(pos) {\n    const {\n      frames,\n      current\n    } = this.state;\n    const total = frames.length;\n\n    switch (pos) {\n      case 'prev':\n        return (current - 1 + total) % total;\n\n      case 'next':\n        return (current + 1) % total;\n\n      default:\n        return current;\n    }\n  }\n\n  transitFramesTowards(direction) {\n    const {\n      prev,\n      current,\n      next\n    } = this.state.movingFrames;\n    const {\n      duration,\n      axis,\n      onTransitionEnd\n    } = this.props;\n    let newCurrentId = this.state.current;\n\n    switch (direction) {\n      case 'up':\n        translateXY(current, 0, -this.state.frameHeight, duration);\n        translateXY(next, 0, 0, duration);\n        newCurrentId = this.getFrameId('next');\n        break;\n\n      case 'down':\n        translateXY(current, 0, this.state.frameHeight, duration);\n        translateXY(prev, 0, 0, duration);\n        newCurrentId = this.getFrameId('prev');\n        break;\n\n      case 'left':\n        translateXY(current, -this.state.frameWidth, 0, duration);\n        translateXY(next, 0, 0, duration);\n        newCurrentId = this.getFrameId('next');\n        break;\n\n      case 'right':\n        translateXY(current, this.state.frameWidth, 0, duration);\n        translateXY(prev, 0, 0, duration);\n        newCurrentId = this.getFrameId('prev');\n        break;\n\n      default:\n        // back to origin\n        translateXY(current, 0, 0, duration);\n\n        if (axis === 'x') {\n          translateXY(prev, -this.state.frameWidth, 0, duration);\n          translateXY(next, this.state.frameWidth, 0, duration);\n        } else if (axis === 'y') {\n          translateXY(prev, 0, -this.state.frameHeight, duration);\n          translateXY(next, 0, this.state.frameHeight, duration);\n        }\n\n    }\n\n    onTransitionEnd && setTimeout(() => onTransitionEnd(this.getSiblingFrames()), duration);\n    this.setState({\n      current: newCurrentId\n    });\n  } // debugFrames () {\n  //   console.log('>>> DEBUG-FRAMES: current', this.state.current)\n  //   const len = this.state.frames.length\n  //   for (let i = 0; i < len; ++i) {\n  //     const ref = this.refs['f' + i]\n  //     console.info(ref.innerText.trim(), ref.style.transform)\n  //   }\n  // }\n\n\n  render() {\n    const {\n      frames,\n      current\n    } = this.state;\n    const {\n      widgets,\n      axis,\n      loop,\n      auto,\n      interval\n    } = this.props;\n    const wrapperStyle = objectAssign(styles.wrapper, this.props.style);\n    return React.createElement(\"div\", {\n      style: wrapperStyle,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 376\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      ref: \"wrapper\",\n      style: objectAssign({\n        overflow: 'hidden'\n      }, wrapperStyle),\n      onTouchStart: this.onTouchStart,\n      className: this.props.className,\n      onMouseDown: this.onTouchStart,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 377\n      },\n      __self: this\n    }, frames.map((frame, i) => {\n      const frameStyle = objectAssign({\n        zIndex: 99 - i\n      }, styles.frame);\n      return React.createElement(\"div\", {\n        ref: 'f' + i,\n        key: i,\n        style: frameStyle,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 386\n        },\n        __self: this\n      }, frame);\n    }), this.props.frames && this.props.children), widgets && [].concat(widgets).map((Widget, i) => React.createElement(Widget, {\n      key: i,\n      index: current,\n      total: frames.length,\n      prevHandler: this.prev,\n      nextHandler: this.next,\n      axis: axis,\n      loop: loop,\n      auto: auto,\n      interval: interval,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 393\n      },\n      __self: this\n    })));\n  }\n\n}\n\nCarousel.propTypes = {\n  axis: PropTypes.oneOf(['x', 'y']),\n  auto: PropTypes.bool,\n  loop: PropTypes.bool,\n  interval: PropTypes.number,\n  duration: PropTypes.number,\n  widgets: PropTypes.arrayOf(PropTypes.func),\n  frames: PropTypes.arrayOf(PropTypes.element),\n  style: PropTypes.object,\n  minMove: PropTypes.number,\n  onTransitionEnd: PropTypes.func\n};\nCarousel.defaultProps = {\n  axis: 'x',\n  auto: false,\n  loop: false,\n  interval: 5000,\n  duration: 300,\n  minMove: 42\n};\n\nfunction translateXY(el, x, y, duration = 0) {\n  if (!el) return;\n  el.style.opacity = '1'; // animation\n\n  el.style.transitionDuration = duration + 'ms';\n  el.style.webkitTransitionDuration = duration + 'ms';\n  el.style.transform = `translate(${x}px, ${y}px)`;\n  el.style.webkitTransform = `translate(${x}px, ${y}px) translateZ(0)`;\n}\n\nfunction objectAssign(target) {\n  var output = Object(target);\n\n  for (var index = 1; index < arguments.length; index++) {\n    var source = arguments[index];\n\n    if (source !== undefined && source !== null) {\n      for (var nextKey in source) {\n        if (source.hasOwnProperty(nextKey)) {\n          output[nextKey] = source[nextKey];\n        }\n      }\n    }\n  }\n\n  return output;\n}\n\nexport default Carousel;","map":{"version":3,"sources":["/home/mindbox/Documents/manoj/nexus/src/components/Carousel/Carousel.js"],"names":["React","PropTypes","styles","frame","width","height","position","Carousel","Component","constructor","props","state","frames","concat","children","current","pos","mounted","debounceTimeoutId","onTouchStart","bind","onTouchMove","onTouchEnd","onResize","autoSlide","prev","next","loop","auto","console","warn","componentDidMount","prepareAutoSlide","hideFrames","refs","wrapper","addEventListener","capture","window","componentWillUnmount","clearAutoTimeout","removeEventListener","componentDidUpdate","_","prevState","length","getDerivedStateFromProps","nextProps","nextState","i","style","opacity","clearTimeout","setTimeout","updateFrameSize","prepareSiblingFrames","e","total","pageX","pageY","touches","setState","startX","startY","deltaX","deltaY","axis","Math","abs","preventDefault","stopPropagation","moveFramesBy","direction","decideEndPosition","transitFramesTowards","duration","minMove","movingFrames","frameWidth","frameHeight","translateXY","slideTimeoutID","interval","slider","rel","getClientRects","cb","getComputedStyle","parseFloat","split","getSiblingFrames","getFrameId","siblings","undefined","onTransitionEnd","newCurrentId","render","widgets","wrapperStyle","objectAssign","overflow","className","map","frameStyle","zIndex","Widget","propTypes","oneOf","bool","number","arrayOf","func","element","object","defaultProps","el","x","y","transitionDuration","webkitTransitionDuration","transform","webkitTransform","target","output","Object","index","arguments","source","nextKey","hasOwnProperty"],"mappings":"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","sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\n\nconst styles = {\n  frame: {\n    width: '100%',\n    height: '100%',\n    position: 'absolute'\n  }\n}\n\nclass Carousel extends React.Component {\n  constructor (props) {\n    super(props)\n\n    this.state = {\n      frames: [].concat(props.frames || props.children || []),\n      current: 0,\n      width: this.props.width,\n      height: this.props.height,\n      position: this.props.pos\n    }\n\n    this.mounted = false\n    this.debounceTimeoutId = null\n    this.onTouchStart = this.onTouchStart.bind(this)\n    this.onTouchMove = this.onTouchMove.bind(this)\n    this.onTouchEnd = this.onTouchEnd.bind(this)\n    this.onResize = this.onResize.bind(this)\n    this.autoSlide = this.autoSlide.bind(this)\n    this.prev = this.prev.bind(this)\n    this.next = this.next.bind(this)\n\n    if (props.loop === false && props.auto) {\n      console.warn('[re-carousel] Auto-slide only works in loop mode.')\n    }\n  }\n\n  componentDidMount () {\n    this.mounted = true\n    this.prepareAutoSlide()\n    this.hideFrames()\n\n    this.refs.wrapper.addEventListener('touchmove', this.onTouchMove, {capture: true})\n    this.refs.wrapper.addEventListener('touchend', this.onTouchEnd, {capture: true})\n    window.addEventListener('resize', this.onResize);\n  }\n\n  componentWillUnmount () {\n    this.mounted = false\n    this.clearAutoTimeout()\n\n    this.refs.wrapper.removeEventListener('touchmove', this.onTouchMove, {capture: true})\n    this.refs.wrapper.removeEventListener('touchend', this.onTouchEnd, {capture: true})\n    window.removeEventListener('resize', this.onResize);\n  }\n\n  componentDidUpdate(_, prevState) {\n    if (this.state.frames.length && this.state.frames.length !== prevState.frames.length) {\n      // reset to default state\n      this.hideFrames()\n      this.prepareAutoSlide()\n    }\n  }\n\n  static getDerivedStateFromProps(nextProps, prevState) {\n    const frames = [].concat(nextProps.frames || nextProps.children || [])\n    const nextState = { frames }\n    if (frames.length && frames.length !== prevState.frames.length) {\n      nextState.current = 0\n    }\n    return nextState\n  }\n\n  hideFrames () {\n    for (let i = 1; i < this.state.frames.length; i++) {\n      this.refs['f' + i].style.opacity = 0\n    }\n  }\n\n  onResize() {\n    clearTimeout(this.debounceTimeoutId);\n    this.debounceTimeoutId = setTimeout(() => {\n      this.updateFrameSize(() => {\n        this.prepareSiblingFrames();\n      });\n    }, 25);\n  }\n\n  onTouchStart (e) {\n    if (this.state.total < 2) return\n    // e.preventDefault()\n\n    this.clearAutoTimeout()\n    this.updateFrameSize()\n    this.prepareSiblingFrames()\n\n    const { pageX, pageY } = (e.touches && e.touches[0]) || e\n    this.setState({\n      startX: pageX,\n      startY: pageY,\n      deltaX: 0,\n      deltaY: 0\n    })\n\n    this.refs.wrapper.addEventListener('mousemove', this.onTouchMove, {capture: true})\n    this.refs.wrapper.addEventListener('mouseup', this.onTouchEnd, {capture: true})\n    this.refs.wrapper.addEventListener('mouseleave', this.onTouchEnd, {capture: true})\n  }\n\n  onTouchMove (e) {\n    if (e.touches && e.touches.length > 1) return\n    this.clearAutoTimeout()\n\n    const { pageX, pageY } = (e.touches && e.touches[0]) || e\n    let deltaX = pageX - this.state.startX\n    let deltaY = pageY - this.state.startY\n    this.setState({\n      deltaX: deltaX,\n      deltaY: deltaY\n    })\n\n    if (this.props.axis === 'x' && Math.abs(deltaX) > Math.abs(deltaY)) {\n      e.preventDefault()\n      e.stopPropagation()\n    }\n    if (this.props.axis === 'y' && Math.abs(deltaY) > Math.abs(deltaX)) {\n      e.preventDefault()\n      e.stopPropagation()\n    }\n\n    // when reach frames edge in non-loop mode, reduce drag effect.\n    if (!this.props.loop) {\n      if (this.state.current === this.state.frames.length - 1) {\n        deltaX < 0 && (deltaX /= 3)\n        deltaY < 0 && (deltaY /= 3)\n      }\n      if (this.state.current === 0) {\n        deltaX > 0 && (deltaX /= 3)\n        deltaY > 0 && (deltaY /= 3)\n      }\n    }\n\n    this.moveFramesBy(deltaX, deltaY)\n  }\n\n  onTouchEnd () {\n    const direction = this.decideEndPosition()\n    direction && this.transitFramesTowards(direction)\n\n    // cleanup\n    this.refs.wrapper.removeEventListener('mousemove', this.onTouchMove, {capture: true})\n    this.refs.wrapper.removeEventListener('mouseup', this.onTouchEnd, {capture: true})\n    this.refs.wrapper.removeEventListener('mouseleave', this.onTouchEnd, {capture: true})\n\n    setTimeout(() => this.prepareAutoSlide(), this.props.duration)\n  }\n\n  decideEndPosition () {\n    const { deltaX = 0, deltaY = 0, current, frames } = this.state\n    const { axis, loop, minMove } = this.props\n\n    switch (axis) {\n      case 'x':\n        if (loop === false) {\n          if (current === 0 && deltaX > 0) return 'origin'\n          if (current === frames.length - 1 && deltaX < 0) return 'origin'\n        }\n        if (Math.abs(deltaX) < minMove) return 'origin'\n        return deltaX > 0 ? 'right' : 'left'\n      case 'y':\n        if (loop === false) {\n          if (current === 0 && deltaY > 0) return 'origin'\n          if (current === frames.length - 1 && deltaY < 0) return 'origin'\n        }\n        if (Math.abs(deltaY) < minMove) return 'origin'\n        return deltaY > 0 ? 'down' : 'up'\n      default:\n    }\n  }\n\n  moveFramesBy (deltaX, deltaY) {\n    const { prev, current, next } = this.state.movingFrames\n    const { frameWidth, frameHeight } = this.state\n\n    switch (this.props.axis) {\n      case 'x':\n        translateXY(current, deltaX, 0)\n        if (deltaX < 0) {\n          translateXY(next, deltaX + frameWidth, 0)\n        } else {\n          translateXY(prev, deltaX - frameWidth, 0)\n        }\n        break\n      case 'y':\n        translateXY(current, 0, deltaY)\n        if (deltaY < 0) {\n          translateXY(next, 0, deltaY + frameHeight)\n        } else {\n          translateXY(prev, 0, deltaY - frameHeight)\n        }\n        break\n      default:\n    }\n  }\n\n  prepareAutoSlide () {\n    if (this.state.frames.length < 2) return\n\n    this.clearAutoTimeout()\n    this.updateFrameSize(() => {\n      this.prepareSiblingFrames()\n    })\n\n    // auto slide only avalible in loop mode\n    if (this.mounted && this.props.loop && this.props.auto) {\n      const slideTimeoutID = setTimeout(this.autoSlide, this.props.interval)\n      this.setState({ slider: slideTimeoutID })\n    }\n  }\n\n  // auto slide to 'next' or 'prev'\n  autoSlide (rel) {\n    this.clearAutoTimeout()\n\n    switch (rel) {\n      case 'prev':\n        this.transitFramesTowards(this.props.axis === 'x' ? 'right' : 'down')\n        break\n      case 'next':\n      default:\n        this.transitFramesTowards(this.props.axis === 'x' ? 'left' : 'up')\n    }\n\n    // prepare next move after animation\n    setTimeout(() => this.prepareAutoSlide(), this.props.duration)\n  }\n\n  next () {\n    const { current, frames } = this.state\n    if (!this.props.loop && current === frames.length - 1) return false\n    this.autoSlide('next')\n  }\n\n  prev () {\n    if (!this.props.loop && this.state.current === 0) return false\n    const { prev, next } = this.state.movingFrames\n\n    if (prev === next) {\n      // Reprepare start position of prev frame\n      // (it was positioned as \"next\" frame)\n      if (this.props.axis === 'x') {\n        translateXY(prev, -this.state.frameWidth, 0, 0)\n      } else {\n        translateXY(prev, 0, -this.state.frameHeight, 0)\n      }\n      prev.getClientRects() // trigger layout\n    }\n\n    this.autoSlide('prev')\n  }\n\n  clearAutoTimeout () {\n    clearTimeout(this.state.slider)\n  }\n\n  updateFrameSize (cb) {\n    const { width, height } = window.getComputedStyle(this.refs.wrapper)\n    this.setState({\n      frameWidth: parseFloat(width.split('px')[0]),\n      frameHeight: parseFloat(height.split('px')[0])\n    }, cb)\n  }\n\n  getSiblingFrames () {\n    return {\n      current: this.refs['f' + this.getFrameId()],\n      prev: this.refs['f' + this.getFrameId('prev')],\n      next: this.refs['f' + this.getFrameId('next')]\n    }\n  }\n\n  prepareSiblingFrames () {\n    const siblings = this.getSiblingFrames()\n\n    if (!this.props.loop) {\n      this.state.current === 0 && (siblings.prev = undefined)\n      this.state.current === this.state.frames.length - 1 && (siblings.next = undefined)\n    }\n\n    this.setState({ movingFrames: siblings })\n\n    // prepare frames position\n    translateXY(siblings.current, 0, 0)\n    if (this.props.axis === 'x') {\n      translateXY(siblings.prev, -this.state.frameWidth, 0)\n      translateXY(siblings.next, this.state.frameWidth, 0)\n    } else {\n      translateXY(siblings.prev, 0, -this.state.frameHeight)\n      translateXY(siblings.next, 0, this.state.frameHeight)\n    }\n\n    return siblings\n  }\n\n  getFrameId (pos) {\n    const { frames, current } = this.state\n    const total = frames.length\n    switch (pos) {\n      case 'prev':\n        return (current - 1 + total) % total\n      case 'next':\n        return (current + 1) % total\n      default:\n        return current\n    }\n  }\n\n  transitFramesTowards (direction) {\n    const { prev, current, next } = this.state.movingFrames\n    const { duration, axis, onTransitionEnd } = this.props\n\n    let newCurrentId = this.state.current\n    switch (direction) {\n      case 'up':\n        translateXY(current, 0, -this.state.frameHeight, duration)\n        translateXY(next, 0, 0, duration)\n        newCurrentId = this.getFrameId('next')\n        break\n      case 'down':\n        translateXY(current, 0, this.state.frameHeight, duration)\n        translateXY(prev, 0, 0, duration)\n        newCurrentId = this.getFrameId('prev')\n        break\n      case 'left':\n        translateXY(current, -this.state.frameWidth, 0, duration)\n        translateXY(next, 0, 0, duration)\n        newCurrentId = this.getFrameId('next')\n        break\n      case 'right':\n        translateXY(current, this.state.frameWidth, 0, duration)\n        translateXY(prev, 0, 0, duration)\n        newCurrentId = this.getFrameId('prev')\n        break\n      default: // back to origin\n        translateXY(current, 0, 0, duration)\n        if (axis === 'x') {\n          translateXY(prev, -this.state.frameWidth, 0, duration)\n          translateXY(next, this.state.frameWidth, 0, duration)\n        } else if (axis === 'y') {\n          translateXY(prev, 0, -this.state.frameHeight, duration)\n          translateXY(next, 0, this.state.frameHeight, duration)\n        }\n    }\n\n    onTransitionEnd && setTimeout(() => onTransitionEnd(this.getSiblingFrames()), duration)\n\n    this.setState({ current: newCurrentId })\n  }\n\n  // debugFrames () {\n  //   console.log('>>> DEBUG-FRAMES: current', this.state.current)\n  //   const len = this.state.frames.length\n  //   for (let i = 0; i < len; ++i) {\n  //     const ref = this.refs['f' + i]\n  //     console.info(ref.innerText.trim(), ref.style.transform)\n  //   }\n  // }\n\n  render () {\n    const { frames, current } = this.state\n    const { widgets, axis, loop, auto, interval } = this.props\n    const wrapperStyle = objectAssign(styles.wrapper, this.props.style)\n\n    return (\n      <div style={wrapperStyle}>\n        <div\n          ref='wrapper'\n          style={objectAssign({overflow: 'hidden'}, wrapperStyle)}\n          onTouchStart={this.onTouchStart}\n          className={this.props.className}\n          onMouseDown={this.onTouchStart} >\n          {\n            frames.map((frame, i) => {\n              const frameStyle = objectAssign({zIndex: 99 - i}, styles.frame)\n              return <div ref={'f' + i} key={i} style={frameStyle}>{frame}</div>\n            })\n          }\n          { this.props.frames && this.props.children }\n        </div>\n        {\n          widgets && [].concat(widgets).map((Widget, i) => (\n            <Widget\n              key={i}\n              index={current}\n              total={frames.length}\n              prevHandler={this.prev}\n              nextHandler={this.next}\n              axis={axis} loop={loop} auto={auto} interval={interval} />\n          ))\n        }\n      </div>\n    )\n  }\n}\n\nCarousel.propTypes = {\n  axis: PropTypes.oneOf(['x', 'y']),\n  auto: PropTypes.bool,\n  loop: PropTypes.bool,\n  interval: PropTypes.number,\n  duration: PropTypes.number,\n  widgets: PropTypes.arrayOf(PropTypes.func),\n  frames: PropTypes.arrayOf(PropTypes.element),\n  style: PropTypes.object,\n  minMove: PropTypes.number,\n  onTransitionEnd: PropTypes.func\n}\n\nCarousel.defaultProps = {\n  axis: 'x',\n  auto: false,\n  loop: false,\n  interval: 5000,\n  duration: 300,\n  minMove: 42\n}\n\nfunction translateXY (el, x, y, duration = 0) {\n  if (!el) return\n\n  el.style.opacity = '1'\n\n  // animation\n  el.style.transitionDuration = duration + 'ms'\n  el.style.webkitTransitionDuration = duration + 'ms'\n\n  el.style.transform = `translate(${x}px, ${y}px)`\n  el.style.webkitTransform = `translate(${x}px, ${y}px) translateZ(0)`\n}\n\nfunction objectAssign (target) {\n  var output = Object(target)\n  for (var index = 1; index < arguments.length; index++) {\n    var source = arguments[index]\n    if (source !== undefined && source !== null) {\n      for (var nextKey in source) {\n        if (source.hasOwnProperty(nextKey)) {\n          output[nextKey] = source[nextKey]\n        }\n      }\n    }\n  }\n  return output\n}\n\nexport default Carousel"]},"metadata":{},"sourceType":"module"}